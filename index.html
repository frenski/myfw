<!doctype html>  

<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>My Friends World</title>
  <meta name="description" content="">
  <meta name="author" content="Yane Frenski">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link rel="stylesheet" href="css/style.css?v=2">
  <link rel="stylesheet" href="css/facebox.css">
  <script src="js/libs/modernizr-1.6.min.js"></script>

</head>

<body>
  
  <div id="fb-root"></div>

  <div id="container">
    <header>

      <h1>MY FRIENDS WORLD</h1>

      <div id="div-top">
      </div>

      <div id="div-fb-but">
        <fb:login-button>Login with Facebook</fb:login-button>
      </div>

    </header>
    
    <div id="main">

      <div id="div-map">
        <img src="images/themap1.jpg" />
      </div>

      <div id="div-canvas">
        <canvas id="canv1" width="900" height="520">
          This browser doesn't support canvas
        </canvas>
      </div>

      <div id="div-owner">
        <h2 id="header-owner-name"></h2>
        <h3 id="header-owner-info"></h3>
      </div>

      <div id="div-fb-unpublished" class="fb-publish">
        Publish on Facebook
      </div>
      
      <div id="div-fb-published" class="fb-publish">
        Posting, please wait<br/>
        <img src="images/loading2.gif" />
      </div>
      
      <div id="thediv">
      </div>
      
      <div id="div-waitbox">
        <br/>
        <img src="images/loading.gif" />
        <h4>loading data from facebook, please wait ...</h4>
      </div>

    </div> <!-- end of #main -->
    
    <footer>

    </footer>
  </div> <!-- end of #container -->


  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="js/libs/jquery-1.4.2.js"%3E%3C/script%3E'))</script>
  
  <script src="js/plugins.js"></script>
  <script src="js/script.js"></script>
  <script src="js/libs/facebox.js"></script>
  <script src="js/libs/imagesq.js"></script>
  <script src="js/countries.js"></script>
  <script src="js/FbDataObject.js"></script>
  <script src="js/DrawInterface.js"></script>
  <script src="js/CountryDots.js"></script>
  <script src="js/ProfPictures.js"></script>
  
  <script src="http://connect.facebook.net/en_US/all.js"></script>
  
  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script> DD_belatedPNG.fix('img, .png_bg'); </script>
  <![endif]-->

  <script>
  
    //initiates a connection with the facebook app
    FB.init({ 
      appId:'173394062703226',
      cookie:true, 
      status:true,
      xfbml:true,
      channelURL : 'http://localhost/myfw/channel.php',
      oauth: true
    });
    
    /* Old - withouth OAuth2 ******************
    FB.init({ 
      appId:'173394062703226', cookie:true, 
      status:true, xfbml:true 
    });
    */
    
    $(document).ready(function($) {
      //Other elements - the box and the button
      $.facebox({ div: '#div-waitbox' });
    });
    
      
    FB.login(function(response) {
      if (response.authResponse) {
        //there is a session
          var fbdata = new FbDataObject();
          fbdata.getFbData();
        } else {
        //user is logged in, but did not grant any permissions
          $("#div-waitbox").append('<div class="attention_note">You need grant special access to the application</strong>');
        }
    }, {scope:'publish_stream,offline_access,user_location,friends_location,user_hometown,friends_hometown'});
    
    
    $('div#div-fb-unpublished').click(function(){
      $('div#div-fb-published').show();
      $('div#div-fb-unpublished').hide();
      var canv1 = document.getElementById("canv1"); //Canvas element
      var canvasData = canv1.toDataURL("image/png");
      $.ajax({
          type: "POST",
          url: "sendpic.php?text2="+$('#header-owner-info').html(),
          data: canvasData,
          contentType: "application/upload; charset=utf-8",
          success: function(data){
            $('div#div-fb-published').html(data);
          }
      });
      
      // var ajax = new XMLHttpRequest();
      // ajax.open("POST",'sendpic.php',false);
      // ajax.setRequestHeader('Content-Type', 'application/upload');
      // ajax.send(canvasData);
    });
    
    
    /* Old - withouth OAuth2 ******************
    FB.login(function(response) {
      if (response.session) {
        //there is a session
        if (response.perms) {
          //the user has granted permissions
          var fbdata = new FbDataObject();
          fbdata.getFbData();
        } else {
        //user is logged in, but did not grant any permissions
          $("#div-waitbox").append('<div class="attention_note">You need grant special access to the application</strong>');
        }
      } else {
        $("#div-waitbox").append('<div class="attention_note">You need to login to Facebook first</strong>');
      }
    }, {perms:'publish_stream,offline_access,user_location,friends_location,user_hometown,friends_hometown'});
  */
  
  //change the UA-XXXXX-X to be your site's ID
   var _gaq = [['_setAccount', 'UA-XXXXX-X'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script>
  
</body>
</html>